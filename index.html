<html>

<head>
	<title>PlayerUrl</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
	<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/videojs-seek-buttons/dist/videojs-seek-buttons.css" rel="stylesheet" />
	<style>
		body {
			margin: 0px;
			overflow: hidden;
			background-color: black;
		}

		.video-js {
			width: 100%;
			height: 100%;
		}

		.vjs-time-divider,
		.video-js .vjs-duration,
		.vjs-no-flex .vjs-duration,
		.video-js .vjs-current-time,
		.vjs-no-flex .vjs-current-time {
			display: block;
		}
	</style>
</head>

<body>
	<video id="my-player" class="video-js vjs-default-skin vjs-big-play-centered" controls loop src=""></video>
</body>

<script src="pt-BR.js"></script>
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script src="https://cdn.sc.gl/videojs-hotkeys/latest/videojs.hotkeys.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-seek-buttons/dist/videojs-seek-buttons.min.js"></script>

<script>
	let params = new URLSearchParams(document.location.search);

	let videoSrc = decodeURIComponent(params.get("url"));

	videojs.addLanguage("pt-BR", ptBR);

	var player = videojs("my-player", {
		controlBar: {
			children: [
				"playToggle",
				"volumePanel",
				"currentTimeDisplay",
				"progressControl",
				"durationDisplay",
				"subsCapsButton",
				"fullscreenToggle",
			],
			volumePanel: {
				inline: false
			}
		},
		language: "pt-BR",
		persistTextTrackSettings: true,
		html5: {
			nativeTextTracks: false
		},
		plugins: {
			hotkeys: {
				seekStep: 10,
				volumeStep: 0.05,
				enableModifiersForNumbers: false
			},
		},
	});

	player.src({
		type: "video/mp4",
		src: videoSrc,
	});

	player.seekButtons({
		forward: 10,
		back: 10,
	});

	let subtitlesSrc = params.get("subtitles");
	if (subtitlesSrc != null) {
		player.addRemoteTextTrack({
			default: true,
			mode: "showing",
			kind: "captions",
			src: decodeURIComponent(subtitlesSrc),
			label: decodeURIComponent(params.get("subtitles_label")),
			srclang: decodeURIComponent(params.get("subtitles_srclang")),
		}, false);
	}

	let videoCode = btoa(videoSrc.substring(Math.max(videoSrc.length - 16, 0), videoSrc.length));

	player.ready(function () {
		let time = params.get("time");
		if (time != null) {
			player.currentTime(time);
		} else {
			let initValue = localStorage.getItem(videoCode);
			if (initValue != "") {
				player.currentTime(initValue);
			}
		}

		player.autoplay(true);
		player.play();

		let lastSeconds = null;
		player.on("timeupdate", function () {
			let seconds = Math.floor(player.currentTime());
			if ((seconds % 5) == 0 && seconds != lastSeconds) {
				if (time != null) {
					let newUrl = new URL(location.href);
					newUrl.searchParams.delete("time");
					window.history.replaceState({}, document.title, newUrl.href);
					time = null;
				}
				localStorage.setItem(videoCode, seconds);
				lastSeconds = seconds;
			}
		});
	});
</script>

</html>